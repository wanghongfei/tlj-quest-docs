# 开发者联系方式

王鸿飞(后端): brucewhf^gmail.com

王富诚(前端): wangfucheng56^gmail.com



> 最后更新时间: 2015-12-10



## 接口测试地址

`http://182.92.153.221/`

# 登陆认证

## Token

### 生成

由于所有接口都以`HTTP RESTful`的形式提供，因此在非Web环境下我们采用Token进行客户端身份识别。用户在app登陆后，服务器会返回一个**由字母组成、20位长的随机字符串**，后续请求带上该参数即可。



### 有效期

Token一旦生成不会自动过期。只有当用户主动注销登陆时，当前Token才会失效。**每个用户仅有一个token**，如果用户未注销前再次登陆，则上次的token自动失效，服务器最新返回的token有效。



### 使用方式

Token放到：A.请求头、B.Query String(GET)、 C.请求体(POST)中均可。

- 方式A

添加如下请求头：

``` 
...
App-Token: WEFEIASIWEdfrilkzxcv
...
```

- 方式B

接口接受`GET`请求，将token添加到URL Query String中：

``` 
GET /api/job/list?appToken=WEFEIASIWEdfrilkzxcv
```

- 方式C

接口接受`POST`请求，将token添加到请求Body中：

``` 
paramA=XXXX&paramB=XXXX&appToken=WEFEIASIWEdfrilkzxcv
```

​

# 服务器返回报文格式

Demo:

``` 
{
  "message": "success",
  "code": 0, // 0表示操作成功
  "data": null,  // 没有返回数据
  "ok": true
}
```

参数说明：

|       参数名        |  必填  |                    说明                    |         示例          |
| :--------------: | :--: | :--------------------------------------: | :-----------------: |
|     message      |  Y   |               返回信息简短的文字说明                | not logged in(未登陆时) |
|       code       |  Y   |                   错误代码                   |                     |
|        ok        |  Y   |                 本次操作是否成功                 |    true / false     |
|       data       |  Y   |        本次操作返回的业务数据，根据业务的不同格式也不同。         |                     |
| data.resultCount |  N   | 如果返回的数据有多条(如一次查询多个用户信息), 则data.resultCount表示结果的总条数(用于计算页码) |                     |
|    data.list     |  N   | 如果返回的数据有多条(如一次查询多个用户信息), 则data字段是一个名为lis的JSON数组 |                     |

带返回数据的Demo:

``` 
{
  "message": "success",
  "code": 0,
  "data": { // data字段是一个名为list的json数组
    "list": [
      {
        "id": 1,
        "name": "cate1",
        "memo": null,
        "themeColor": null,
        "level": 1
      }
    ],
    "resultCount": 2  // 表示一共有2条数据，但本次只请求了第1条
  },
  "ok": true
}
```



# 错误代码表

|  代码  |           含义            |
| :--: | :---------------------: |
|  -2  | HTTP状态码不是5XX, 200时返回该代码 |
|  -1  |          操作失败           |
|  0   |          操作成功           |
|  1   |         操作过于频繁          |
|  2   |         用户名不合法          |
|  3   |          密码错误           |
|  4   |          用户不存在          |
|  5   |          用户已存在          |
|  6   |          用户被封号          |
|  7   |           未登陆           |
|  8   |         两次输入不一致         |
|  9   |          分类不为空          |
|  10  |         必填字段为空          |
|  11  |          非法参数           |
|  12  |           不存在           |
|  13  |          权限不足           |
|  14  |        不能删除当前用户         |
|  15  |          已经存在           |
|  16  |        已经喜欢/收藏过了        |
|  17  |          非法数字           |
|  18  |         账户余额不足          |
|  19  |         现金账户不存在         |
|  20  |         任务重复领取          |
|  21  |          任务已领完          |
|  22  |          任务已结束          |
|  23  |          任务未领取          |
|  24  |          重复提交           |
|  25  |          验证码错误          |
|  26  |        用户已经认证过了         |
|  27  |         任务还没有开始         |
|  28  |         状态不能被修改         |
|  29  |         需要先解绑手机         |
|  30  |        代审核剩余数量不足        |
|  31  |       该手机号未关联任何账号       |
|  32  |         该任务没有问卷         |
|  33  |     非法调用(黑客恶意发送请求)      |
|  34  |   短信发送失败，短信服务商接口调用出错    |
|  35  |         密保答案不正确         |
|  36  |         密保已经存在          |
|  37  |         委托金额太少          |
|  38  |         卡券领取失败          |
|  39  |          卡券非法           |
|  40  |        卡券已经被使用过         |
|  41  |          卡券过期           |
|  42  |       还未通过学生身份认证        |
|  43  |       还未通过商家身份认证        |
|  44  |        相关账号还未设置         |
|  45  |         任务对象不匹配         |
|  46  |       还未通过个人身份认证        |

注： 客户端应**首先验证HTTP状态码是否为5XX**, 如果不是则按上面的错误代码表解析返回报文，如果是则忽略返回报文。



## 关于停机维护

**客户端每收到一个HTTP响应，都应当判断是否存在名为`Server-Status`的请求头，如果存在则说明服务器正在维护暂时无法提供服务，并提示用户。**